var varqa_api_url=sessionStorage.getItem("varqaapiurl"),myuser=sessionStorage.getItem("varqauser"),mypass=sessionStorage.getItem("varqapass");function change_group(a){gid=a,localStorage.setItem("gid",a),data_r='<object id="if" type="text/html" data="data.html?group='+gid+'"></object>',$(".data").html(data_r),wajx(!1),wajx(),$("#mess").select()}function this_type(a,e,t){if(1==e)var s='<div class="messbox"><button onclick="varqa_group_unblock('+a+", "+t+')"  class="cbutton">نامسدود</button></div>';else if(1==t)s='<div class="messbox"><div class="right"><textarea id="mess" placeholder="گل فرمایش کنین..." autocomplete="off"></textarea><input id="subm" name="submit" type="submit" value="بفرست" class="button"><a href="send_file/"><button class="button">فایل</button></a></div><div class="left"><button style="width: 3em;" class="button" onclick="myoptions()">|||</button>';else s='<div class="messbox"><button onclick="varqa_group_delete('+a+')" class="cbutton">ترک کانال</button></div>';var o='<button onclick="varqa_group_block('+a+", "+t+')" class="hbutton" style="top: 46%;">مسدود</button><button onclick="varqa_group_delete('+a+')" class="hbutton" style="top: 54%;">خداحافظی با اینجا</button>';$("#goptions").html(o),$(".container").html(s)}function wajx(a=!0){$.ajax({type:"GET",url:varqa_api_url+"get/groups/",headers:{varqauser:myuser,varqapass:mypass},data:{group_id:"all",check:a},dataType:"json",contentType:"application/json",success:function(e){1==e.ok&&($(".mainmenu").empty(),$.each(e.results,function(e,t){if(null!=t){var s="background-color: #5D5D5D; color:black;";if(t.gid==gid){0==a&&this_type(t.gid,t.blocked,t.author);s="background-color:#166484; color:#f5f5f5;"}else if(t.not_reads_count>0)s="background-color:black; color:#f5f5f5;";if("private"==t.type)if(2==t.member_count)var o="هست",n="هنوز لفت نداده";else o="نیست",n="لفت داد رفت!";else o=t.member_count,n=t.member_count+" عضو";if(0==t.not_reads_count)var i="پیام خوانده نشده ندارید";else i=t.not_reads_count+" پیام خوانده نشده دارید";var l=t.last_message;if(null!=l)if(null!=l.author)if("file"==l.content)if("you"==l.author)var r="شما: فایل";else r=l.author+": فایل";else if("you"==l.author)r="شما: "+l.content;else r=l.author+": "+l.content;else r="file"==l.content?"فایل":l.content;else r="تهی";var u='<button title="جهت کپی توکن راست کلیک کنید" oncontextmenu="javascript:varqatokencopy(\''+t.group_login_info.token+"', '"+t.group_login_info.admintoken+'\');return false;" onclick="change_group('+t.gid+')" class="mensub" style="'+s+'"><p title="'+n+'" class="ozv">'+o+'</p><p title="'+i+'" class="new">'+t.not_reads_count+'</p><p class="matn">'+t.title+'</p><p class="zirmatn"><i>'+r+'</i></p><input style="display: none;" type="text" value="'+t.group_login_info.token+'" id="'+t.group_login_info.token+'"></button><br>';$(".mainmenu").append(u)}else $(".mainmenu").append("هیشکی نیست...")}))}}),0!=a&&(t=setTimeout(wajx,5e3))}function myoptions(){$("#goptions").css("display","block")}function varqatokencopy(a,e){if("null"!=a){var t=document.getElementById(a);t.style.display="block",t.select(),t.setSelectionRange(0,99999),document.execCommand("copy"),t.style.display="none",alert("null"!=e?"توکن اینجا در کلیپ بورد ذخیره شد \n همچنین توکن ادمین ساز این کانال: \n"+e:"توکن این گروه در کلیپ بورد ذخیره شد")}else alert("توکن اینجا رو ندارید!!!")}function motmaen(){return!!confirm("مطمئنی؟؟؟!!!")}function sendm(){var a=$("#mess").val();$.ajax({type:"POST",url:varqa_api_url+"insert/",headers:{varqauser:myuser,varqapass:mypass},data:'{"content": "'+a+'", "group_id": '+gid+"}",dataType:"json",contentType:"application/json",success:function(a){1==a.ok&&($("#mess").val(""),$("#mess").select())}})}function create_contact(){var a=$("#usertel").val();$.ajax({type:"POST",url:varqa_api_url+"private/",headers:{varqauser:myuser,varqapass:mypass},data:'{"contact": "'+a+'"}',dataType:"json",contentType:"application/json",success:function(a){1==a.ok?($("#usertel").val(""),$(".modal").css("display","none")):($("#modalerror").css("display","block"),setTimeout(function(){$("#modalerror").css("display","none")},2e3))}})}function show_modal(){$(".modal").css("display","block")}function varqa_group_block(a,e){$.ajax({type:"POST",url:varqa_api_url+"group/block/",headers:{varqauser:myuser,varqapass:mypass},data:'{"group_id": '+a+"}",dataType:"json",contentType:"application/json",success:function(t){1==t.ok&&($("#goptions").css("display","none"),$(".container").html('<div class="messbox"><button onclick="varqa_group_unblock('+a+", "+e+')"  class="cbutton">نامسدود</button></div>'))}})}function varqa_group_unblock(a,e){$.ajax({type:"POST",url:varqa_api_url+"group/unblock/",headers:{varqauser:myuser,varqapass:mypass},data:'{"group_id": '+a+"}",dataType:"json",contentType:"application/json",success:function(t){1==t.ok&&(this_type(a,!1,e),wajx(!1))}})}function varqa_group_delete(a,e){$.ajax({type:"POST",url:varqa_api_url+"group/leave/",headers:{varqauser:myuser,varqapass:mypass},data:'{"group_id": '+a+"}",dataType:"json",contentType:"application/json",success:function(a){1==a.ok&&($("#goptions").css("display","none"),wajx(!1))}})}function sc(){$("#mess").select(),wajx(!1),wajx()}function varqaclose(){sessionStorage.removeItem("varqauser"),sessionStorage.removeItem("varqapass"),window.location.replace(sessionStorage.getItem("varqaweburl"))}function get_baqi(){var a=window.scrollY,e=localStorage.getItem("last_mess");0==a&&get_all_data(e)}function get_all_data(a=null){$.ajax({type:"GET",url:varqa_api_url+"get/data/",headers:{varqauser:myuser,varqapass:mypass},data:{group_id:dgid,from:a},success:function(e){var t=JSON.parse(e);if(1==t.ok){var s=localStorage.getItem("last_count");$.each(t.results,function(e,t){var o=t.date.split("|");if("you"==t.author)var n="ma1",i="margin-left: auto;",l=t.not_reads_count==localStorage.getItem("tak_member_count")-1&&1!=localStorage.getItem("tak_member_count")?"dat2":"dat1";else n="ma2",i="private"==t.type||null==t.author?"margin-left: 0;":"margin-left: 4.5em;",l="dat1";var r="dat1"==l?"*":"",u=null!=t.author&&"you"!=t.author&&"private"!=t.type?'<div class="title"> '+t.author+"</div>":"<div></div>",c=t.content?t.content:"",p="";t.files&&$.each(t.files,function(a,e){"image/jpeg"==e.type||"image/png"==e.type?p+='<a href="'+e.file+'"><img class="fileimg" src="'+e.file+'"></a><br>':"audio/mpeg"==e.type&&(p+='<audio controls><source src="'+e.file+'" type="audio/mpeg"></audio><br>')});var d='<div class="kol">'+u+'<div title="'+o[1]+" "+o[0]+'" id="'+s+'" style="'+i+'" class="'+n+'"><p class="asl">'+p+c+'</p><p id="'+t.id+'" class="'+l+'">'+o[2]+r+"</p></div></div>";localStorage.setItem("last_mess",t.id),0!=s?$("#matlab").prepend(d):$("#matlab").append(d),count=++s,localStorage.setItem("last_count",count),null==a?scr():new_scr(a)})}else null==a&&(null==t.results?$(".mainmenu").append("در اینجا حضور ندارید"):$("#matlab").append("<p>پیامی ندارید</p>"))}})}function ajx(a=!1){$.ajax({type:"GET",url:varqa_api_url+"get/updates/",headers:{varqauser:myuser,varqapass:mypass},data:{group_id:dgid},dataType:"json",contentType:"application/json",success:function(e){1==e.ok&&(1==a&&$("#matlab").append('<div id="jadid" class="jadid">جدید</div>'),$.each(e.results,function(a,e){var t=e.date.split("|");if("you"==e.author)var s="ma1",o="dat2",n="margin-left: auto;";else s="ma2",o="dat1",n="private"==e.type||null==e.author?"margin-left: 0;":"margin-left: 4.5em;";var i="dat1"==o?"*":"",l=null!=e.author&&"you"!=e.author&&"private"!=e.type?'<div class="title"> '+e.author+"</div>":"<div></div>",r=e.content?e.content:"",u="";e.files&&$.each(e.files,function(a,e){"image/jpeg"==e.type||"image/png"==e.type?u+='<a href="'+e.file+'"><img class="fileimg" src="'+e.file+'"></a><br>':"audio/mpeg"==e.type&&(u+='<audio controls><source src="'+e.file+'" type="audio/mpeg"></audio><br>')});var c='<div class="kol">'+l+'<div title="'+t[1]+" "+t[0]+'" style="'+n+'" class="'+s+'"><p class="asl">'+u+r+'</p><p id="'+e.id+'" class="'+o+'">'+t[2]+i+"</p></div></div>";$(c).appendTo("#matlab").show("slow")}),1==a?sscr():scr()),1==a&&reads()}}),1!=a&&(t=setTimeout(ajx,2e3))}function get_group_info(a=!1){$.ajax({type:"GET",url:varqa_api_url+"get/groups/",headers:{varqauser:myuser,varqapass:mypass},data:{group_id:dgid,check:a},dataType:"json",contentType:"application/json",success:function(e){if(1==e.ok)if(0==a){var t=e.results[0];$("#titre").html(t.title),localStorage.setItem("tak_member_count",t.member_count)}else $.each(e.results[0],function(a,e){if("online"==e.status)var t='<i style="color: teal;">آیلاند</i>';else{var s=new Date,o=e.status.split("|"),n=o[1].split("/");t="آخرین بازدید ";o[0]==s.getFullYear()&&n[0]==s.getMonth()+1&&n[1]==s.getDate()?t+=o[2]:o[0]==s.getFullYear()&&n[0]==s.getMonth()+1&&n[1]==s.getDate()-1?t+="دیروز":o[0]==s.getFullYear()&&n[0]==s.getMonth()+1?t+=s.getDate()-n[1]+" روز پیش":o[0]==s.getFullYear()?t+=s.getMonth()+1-n[0]+" ماه پیش":t+="سال های قبل"}var i="<p>"+e.name+'<i style="font-size: 80%">('+e.user+"):</i> "+t+"</p>";$("#membs").append(i)})}}),0!=a&&(t=setTimeout(ajx,1e4))}function show_mems(){$("#memb").css("display","block")}function reads(){var a=[];$(".dat2").each(function(){var e=$(this).attr("id");a.push(e)});var e=a.join();e&&$.ajax({type:"GET",url:varqa_api_url+"check/view/",headers:{varqauser:myuser,varqapass:mypass},data:{mid:e,gid:dgid},dataType:"json",contentType:"application/json",success:function(a){1==a.ok&&$.each(a.results,function(a,e){1==e.view&&(thismidid=String("#"+e.mid),"#"!=thismidid&&($(thismidid).removeClass("dat2").addClass("dat1"),$(thismidid).append("*")))})}}),t=setTimeout(reads,3e3)}function scr(){window.scrollTo(0,document.body.scrollHeight)}function new_scr(a){$("html, body").animate({scrollTop:$("#"+a).offset().top},1)}function sscr(){$("html, body").animate({scrollTop:$("#jadid").offset().top},1e3)}