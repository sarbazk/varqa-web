var varqa_api_url=sessionStorage.getItem("varqaapiurl"),myuser=sessionStorage.getItem("varqauser"),mypass=sessionStorage.getItem("varqapass");function change_group(a){gid=a,dgid=a,localStorage.setItem("gid",a),$("#matlab").html(""),wajx(!1),wajx(),localStorage.setItem("last_count",0),localStorage.setItem("last_mess",0),get_group_info(),get_group_info(!0),get_all_data(),ajx(!0),ajx(),$("#mess").select()}function this_type(a,t,e){if(1==t)var s='<div class="messbox"><button onclick="varqa_group_unblock('+a+", "+e+')"  class="cbutton">نامسدود</button></div>';else if(1==e)s='<div class="messbox"><div class="right"><textarea id="mess" placeholder="گل فرمایش کنین..." autocomplete="off"></textarea><input id="subm" name="submit" type="submit" value="بفرست" class="button"><a href="send_file/"><button class="button">فایل</button></a></div><div class="left"><button style="width: 3em;" class="button" onclick="myoptions()">|||</button>';else s='<div class="messbox"><button onclick="varqa_group_delete('+a+')" class="cbutton">ترک کانال</button></div>';var o='<button onclick="varqa_group_block('+a+", "+e+')" class="hbutton" style="top: 46%;">مسدود</button><button onclick="varqa_group_delete('+a+')" class="hbutton" style="top: 54%;">خداحافظی با اینجا</button>';$("#goptions").html(o),$(".container").html(s)}function wajx(a=!0){$.ajax({type:"GET",url:varqa_api_url+"get/groups/",headers:{varqauser:myuser,varqapass:mypass},data:{group_id:"all",check:a},dataType:"json",contentType:"application/json",success:function(t){1==t.ok&&(ajx(),$(".mainmenu").empty(),$.each(t.results,function(t,e){if(null!=e){var s="background-color: #5D5D5D; color:black;";if(e.gid==gid){0==a&&this_type(e.gid,e.blocked,e.author);s="background-color:#166484; color:#f5f5f5;"}else if(e.not_reads_count>0)s="background-color:black; color:#f5f5f5;";if("private"==e.type)if(2==e.member_count)var o="هست",n="هنوز لفت نداده";else o="نیست",n="لفت داد رفت!";else o=e.member_count,n=e.member_count+" عضو";if(0==e.not_reads_count)var r="پیام خوانده نشده ندارید";else r=e.not_reads_count+" پیام خوانده نشده دارید";var l=e.last_message;if(null!=l)if(null!=l.author)if("file"==l.content)if("you"==l.author)var i="شما: فایل";else i=l.author+": فایل";else if("you"==l.author)i="شما: "+l.content;else i=l.author+": "+l.content;else i="file"==l.content?"فایل":l.content;else i="تهی";var c='<button title="جهت کپی توکن راست کلیک کنید" oncontextmenu="javascript:varqatokencopy(\''+e.group_login_info.token+"', '"+e.group_login_info.admintoken+'\');return false;" onclick="change_group('+e.gid+')" class="mensub" style="'+s+'"><p title="'+n+'" class="ozv">'+o+'</p><p title="'+r+'" class="new">'+e.not_reads_count+'</p><p class="matn">'+e.title+'</p><p class="zirmatn"><i>'+i+'</i></p><input style="display: none;" type="text" value="'+e.group_login_info.token+'" id="'+e.group_login_info.token+'"></button><br>';$(".mainmenu").append(c)}else $(".mainmenu").append("هیشکی نیست...")}))}}),$("p").hasClass("dat2")&&reads(),0!=a&&(t=setTimeout(wajx,5e3))}function myoptions(){$("#goptions").css("display","block")}function varqatokencopy(a,t){if("null"!=a){var e=document.getElementById(a);e.style.display="block",e.select(),e.setSelectionRange(0,99999),document.execCommand("copy"),e.style.display="none",alert("null"!=t?"توکن اینجا در کلیپ بورد ذخیره شد \n همچنین توکن ادمین ساز این کانال: \n"+t:"توکن این گروه در کلیپ بورد ذخیره شد")}else alert("توکن اینجا رو ندارید!!!")}function motmaen(){return!!confirm("مطمئنی؟؟؟!!!")}function sendm(){var a=$("#mess").val();mstr=a.replace(/(?:\r\n|\r|\n)/g,"\\\\n"),$.ajax({type:"POST",url:varqa_api_url+"insert/",headers:{varqauser:myuser,varqapass:mypass},data:'{"content": "'+mstr+'", "group_id": '+gid+"}",dataType:"json",contentType:"application/json",success:function(a){1==a.ok&&(ajx(),$("#mess").val(""),$("#mess").select())}})}function create_contact(){var a=$("#usertel").val();$.ajax({type:"POST",url:varqa_api_url+"private/",headers:{varqauser:myuser,varqapass:mypass},data:'{"contact": "'+a+'"}',dataType:"json",contentType:"application/json",success:function(a){1==a.ok?($("#usertel").val(""),$(".modal").css("display","none")):($("#modalerror").css("display","block"),setTimeout(function(){$("#modalerror").css("display","none")},2e3))}})}function show_modal(){$(".modal").css("display","block")}function varqa_group_block(a,t){$.ajax({type:"POST",url:varqa_api_url+"group/block/",headers:{varqauser:myuser,varqapass:mypass},data:'{"group_id": '+a+"}",dataType:"json",contentType:"application/json",success:function(e){1==e.ok&&($("#goptions").css("display","none"),$(".container").html('<div class="messbox"><button onclick="varqa_group_unblock('+a+", "+t+')"  class="cbutton">نامسدود</button></div>'))}})}function varqa_group_unblock(a,t){$.ajax({type:"POST",url:varqa_api_url+"group/unblock/",headers:{varqauser:myuser,varqapass:mypass},data:'{"group_id": '+a+"}",dataType:"json",contentType:"application/json",success:function(e){1==e.ok&&(this_type(a,!1,t),wajx(!1))}})}function varqa_group_delete(a,t){$.ajax({type:"POST",url:varqa_api_url+"group/leave/",headers:{varqauser:myuser,varqapass:mypass},data:'{"group_id": '+a+"}",dataType:"json",contentType:"application/json",success:function(a){1==a.ok&&($("#goptions").css("display","none"),wajx(!1))}})}function sc(){$("#mess").select(),wajx(!1),wajx()}function varqaclose(){sessionStorage.removeItem("varqauser"),sessionStorage.removeItem("varqapass"),window.location.replace(sessionStorage.getItem("varqaweburl"))}function get_baqi(){var a=$(".data").scrollTop(),t=localStorage.getItem("last_mess");0==a&&get_all_data(t)}function get_all_data(a=null){$.ajax({type:"GET",url:varqa_api_url+"get/data/",headers:{varqauser:myuser,varqapass:mypass},data:{group_id:dgid,from:a},success:function(t){var e=JSON.parse(t);if(1==e.ok){var s=localStorage.getItem("last_count");$.each(e.results,function(a,t){var e=t.date.split("|");if("you"==t.author)var o="ma1",n="margin-left: auto;",r=t.not_reads_count==localStorage.getItem("tak_member_count")-1&&1!=localStorage.getItem("tak_member_count")?"dat2":"dat1";else o="ma2",n="private"==t.type||null==t.author?"margin-left: 0;":"margin-left: 4.5em;",r="dat1";var l="dat1"==r?"*":"",i=null!=t.author&&"you"!=t.author&&"private"!=t.type?'<div class="title"> '+t.author+"</div>":"<div></div>",c=t.content?t.content:"";mycontent=c.replace(/(?:\r\n|\r|\n)/g,"<br>");var u="";t.files&&$.each(t.files,function(a,t){"image/jpeg"==t.type||"image/png"==t.type?u+='<a href="'+t.file+'"><img class="fileimg" src="'+t.file+'"></a><br>':"audio/mpeg"==t.type&&(u+='<audio controls><source src="'+t.file+'" type="audio/mpeg"></audio><br>')});var p='<div id="'+t.id+'" class="kol">'+i+'<div title="'+e[1]+" "+e[0]+'" style="'+n+'" class="'+o+'"><p class="asl">'+u+mycontent+'</p><p id="m'+t.id+'" class="'+r+'">'+e[2]+l+"</p></div></div>";localStorage.setItem("last_mess",t.id),0!=s?$("#matlab").prepend(p):$("#matlab").append(p),count=++s,localStorage.setItem("last_count",count)}),null==a?scr():new_scr(a)}else null==a&&(null==e.results?$(".mainmenu").append("در اینجا حضور ندارید"):$("#matlab").append("<p>پیامی ندارید</p>"))}})}var oomad=document.createElement("audio");oomad.setAttribute("src","https://web.varqa.ir/when.mp3");var raft=document.createElement("audio");function ajx(a=!1){$.ajax({type:"GET",url:varqa_api_url+"get/updates/",headers:{varqauser:myuser,varqapass:mypass},data:{group_id:dgid},dataType:"json",contentType:"application/json",success:function(t){1==t.ok&&(1==a&&$("#matlab").append('<div id="jadid" class="jadid">جدید</div>'),$.each(t.results,function(a,t){"you"==t.author?raft.play():oomad.play();var e=t.date.split("|");if("you"==t.author)var s="ma1",o="dat2",n="margin-left: auto;";else s="ma2",o="dat1",n="private"==t.type||null==t.author?"margin-left: 0;":"margin-left: 4.5em;";var r="dat1"==o?"*":"",l=null!=t.author&&"you"!=t.author&&"private"!=t.type?'<div class="title"> '+t.author+"</div>":"<div></div>",i=t.content?t.content:"";mycontent=i.replace(/(?:\r\n|\r|\n)/g,"<br>");var c="";t.files&&$.each(t.files,function(a,t){"image/jpeg"==t.type||"image/png"==t.type?c+='<a href="'+t.file+'"><img class="fileimg" src="'+t.file+'"></a><br>':"audio/mpeg"==t.type&&(c+='<audio controls><source src="'+t.file+'" type="audio/mpeg"></audio><br>')});var u='<div class="kol">'+l+'<div title="'+e[1]+" "+e[0]+'" style="'+n+'" class="'+s+'"><p class="asl">'+c+mycontent+'</p><p id="m'+t.id+'" class="'+o+'">'+e[2]+r+"</p></div></div>";$(u).appendTo("#matlab").show("slow")}),1==a?sscr():scr())}})}function get_group_info(a=!1){$.ajax({type:"GET",url:varqa_api_url+"get/groups/",headers:{varqauser:myuser,varqapass:mypass},data:{group_id:dgid,check:a},dataType:"json",contentType:"application/json",success:function(t){if(1==t.ok)if(0==a){var e=t.results[0];$("#titre").html(e.title),localStorage.setItem("tak_member_count",e.member_count)}else $("#membs").html(""),$("#membs").append("افراد:<br>"),$.each(t.results[0],function(a,t){if("online"==t.status)var e='<i style="color: teal;">آیلاند</i>';else{var s=new Date,o=t.status.split("|"),n=o[1].split("/");e="آخرین بازدید ";o[0]==s.getFullYear()&&n[0]==s.getMonth()+1&&n[1]==s.getDate()?e+=o[2]:o[0]==s.getFullYear()&&n[0]==s.getMonth()+1&&n[1]==s.getDate()-1?e+="دیروز":o[0]==s.getFullYear()&&n[0]==s.getMonth()+1?e+=s.getDate()-n[1]+" روز پیش":o[0]==s.getFullYear()?e+=s.getMonth()+1-n[0]+" ماه پیش":e+="سال های قبل"}var r="<p>"+t.name+'<i style="font-size: 80%">('+t.user+"):</i> "+e+"</p>";$("#membs").append(r)})}})}function show_mems(){get_group_info(!0),$("#memb").css("display","block")}function reads(){var a=[];$(".dat2").each(function(){var t=$(this).attr("id");a.push(t.replace("m",""))});var t=a.join();t&&$.ajax({type:"GET",url:varqa_api_url+"check/view/",headers:{varqauser:myuser,varqapass:mypass},data:{mid:t,gid:dgid},dataType:"json",contentType:"application/json",success:function(a){1==a.ok&&$.each(a.results,function(a,t){1==t.view&&(thismidid=String("#"+t.mid),"#"!=thismidid&&($(thismidid).removeClass("dat2").addClass("dat1"),$(thismidid).append("*")))})}})}function scr(){var a=$("#matlab").height();$(".data").scrollTop(a)}function new_scr(a){var t="#"+parseInt(a),e=$(t).offset().top;$(".data").scrollTop(e)}function sscr(){$(".data").animate({scrollTop:$("#jadid").offset().top},1e3)}raft.setAttribute("src","https://web.varqa.ir/hollow.mp3");